<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Radio Pomodoro Timer</title>
    <link rel="stylesheet" href="styles.css"/>
</head>
<body>
    <div class="radio">
        <div class="radio-top">
            <div class="radio-brand">POMODORO</div>
            <div class="radio-model">MODEL X-25</div>
        </div>
        
        <div class="led" id="statusLed"></div>
        
        <div class="screen" id="screen">
            <div class="timer-mode" id="timerMode">SESSION</div>
            <div class="timer" id="timer">25:00</div>
        </div>
        
        <div class="control-buttons">
            <button class="control-btn focus" id="focusBtn">FOCUS</button>
            <button class="control-btn pause" id="pauseBtn">PAUSE</button>
            <button class="control-btn reset" id="resetBtn">RESET</button>
        </div>
        
        <div class="dials-container">
            <div class="dial-section">
                <div class="dial-label">SESSION LENGTH</div>
                <div class="dial session-dial" style="--session-angle: 90" id="sessionDial">
                    <div class="dial-value" id="sessionValue">25</div>
                </div>
                <div class="adjust-buttons">
                    <button class="adjust-btn" id="sessionMinus">-</button>
                    <button class="adjust-btn" id="sessionPlus">+</button>
                </div>
            </div>
            
            <div class="dial-section">
                <div class="dial-label">BREAK LENGTH</div>
                <div class="dial break-dial" style="--break-angle: 90" id="breakDial">
                    <div class="dial-value" id="breakValue">5</div>
                </div>
                <div class="adjust-buttons">
                    <button class="adjust-btn" id="breakMinus">-</button>
                    <button class="adjust-btn" id="breakPlus">+</button>
                </div>
            </div>
        </div>
        
        <div class="audio-control">
            <span class="volume-symbol">â™ª</span> STEREO
        </div>
        
        <!-- Add local audio element -->
        <audio id="alarmSound">
            <source src="data:audio/mp3;base64,SUQzAwAAAAAAIlRJVDIAAAAZAAAAU3RhbmRhcmQgQWxhcm0gQmVlcCBTb3VuZFRZRVIAAAAFAAAAMjAyMgD/+5DEAAAIZGFIVTBACnrIKRMmgAEMABDIAIo4JDIwMiAAA1vWx4CAsAAjhGIyICQyAGIsAEBAApQxYA4Dh5JwPkQmA2AeIEUVFTEUEmPIhIAOAsEMRDAAEBJAmBwACRKQXhcbQT8A8hAAMAzGhpgmAWS1NTJAmBaAOAoGsSwVJMKg6hSMhQDg7AwDQREOQKJMJRJXbXbXjQEjIAgJgGK4LgqGQDRHmwCQZwMGQJ0hZpFAcJOodkxpCIQw0FgwlMVm1+CZv1X/2oEBwAxCkLSIJBcZBiJEgaxdDkDiRFEiGKEDT1////6wEAqDAUfLILDVJF8gACQgCA3MbVVUyXv/+v/6isxuGQlmRGGuQVgHSO+37UdBk5oYBQwCSSgWDAJgRQdKsLKBRACMp7MMFD//5UQyAmwcHBZVHzQTL//l/v//D3LHhMaFyeG9sGgxAZMHSGC5f/////+BQAXQvUkDOJGKv+WBomkZjIdxowJKGDFABP/7ksQWAIgZhS3HsG+pDTPmOPMN9QxrY4AAgKGARMPUsCELDCBgwD8JAARo+GpKF1cwQsGAQMEUDBBxI08DCATMKQED4RGEVAEVTEFNRTMuOTguNFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//uQxCmAFaHfIcYYr6MAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV" type="audio/mp3">
        </audio>
    </div>

    <script>
        // DOM Elements
        const timer = document.getElementById('timer');
        const timerMode = document.getElementById('timerMode');
        const screen = document.getElementById('screen');
        const focusBtn = document.getElementById('focusBtn');
        const pauseBtn = document.getElementById('pauseBtn');
        const resetBtn = document.getElementById('resetBtn');
        const sessionValue = document.getElementById('sessionValue');
        const breakValue = document.getElementById('breakValue');
        const sessionDial = document.getElementById('sessionDial');
        const breakDial = document.getElementById('breakDial');
        const sessionPlus = document.getElementById('sessionPlus');
        const sessionMinus = document.getElementById('sessionMinus');
        const breakPlus = document.getElementById('breakPlus');
        const breakMinus = document.getElementById('breakMinus');
        const statusLed = document.getElementById('statusLed');

        // Timer variables
        let countdown;
        let isRunning = false;
        let currentMode = 'session'; // 'session' or 'break'
        let sessionLength = 25;
        let breakLength = 5;
        let timeLeft = sessionLength * 60; // in seconds

        // Audio for notifications
        const alarmSound = document.getElementById('alarmSound');

        // Update session length - FIX: Allow adjustments when not running
        function updateSessionLength(change) {
            if (!isRunning) {
                sessionLength = Math.max(1, Math.min(60, sessionLength + change));
                sessionValue.textContent = sessionLength;
                
                if (currentMode === 'session') {
                    timeLeft = sessionLength * 60;
                    updateDisplay();
                }
                
                updateSessionDial();
            }
        }

        // Update break length - FIX: Allow adjustments when not running
        function updateBreakLength(change) {
            if (!isRunning) {
                breakLength = Math.max(1, Math.min(30, breakLength + change));
                breakValue.textContent = breakLength;
                
                if (currentMode === 'break') {
                    timeLeft = breakLength * 60;
                    updateDisplay();
                }
                
                updateBreakDial();
            }
        }

        // Update dial positions
        function updateSessionDial() {
            // Map 1-60 to 0-180 degrees
            const angle = (sessionLength - 1) * (180 / 59);
            sessionDial.style.setProperty('--session-angle', angle);
        }

        function updateBreakDial() {
            // Map 1-30 to 0-180 degrees
            const angle = (breakLength - 1) * (180 / 29);
            breakDial.style.setProperty('--break-angle', angle);
        }

        // Update timer display
        function updateDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            timer.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // FIX: Function to play alarm sound with user interaction
        function playAlarmSound() {
            // Reset the audio to the beginning
            alarmSound.currentTime = 0;
            
            // Play the sound
            alarmSound.play().catch(error => {
                console.error("Error playing alarm sound:", error);
                // Create a user interaction to allow sound to play in the future
                alert("Time's up! Click OK to continue.");
            });
        }

        // Start timer
        function startTimer() {
            if (isRunning) return;
            
            isRunning = true;
            statusLed.style.animation = 'blink 0.5s infinite';
            
            countdown = setInterval(() => {
                timeLeft--;
                updateDisplay();
                
                if (timeLeft <= 0) {
                    clearInterval(countdown);
                    playAlarmSound(); // FIX: Use the new function
                    
                    // Switch modes
                    if (currentMode === 'session') {
                        currentMode = 'break';
                        timerMode.textContent = 'BREAK';
                        screen.classList.add('break-mode');
                        timeLeft = breakLength * 60;
                    } else {
                        currentMode = 'session';
                        timerMode.textContent = 'SESSION';
                        screen.classList.remove('break-mode');
                        timeLeft = sessionLength * 60;
                    }
                    
                    updateDisplay();
                    startTimer(); // Auto-start next phase
                }
            }, 1000);
        }

        // Pause timer
        function pauseTimer() {
            clearInterval(countdown);
            isRunning = false;
            statusLed.style.animation = 'blink 2s infinite';
        }

        // Reset timer
        function resetTimer() {
            clearInterval(countdown);
            isRunning = false;
            currentMode = 'session';
            timerMode.textContent = 'SESSION';
            screen.classList.remove('break-mode');
            timeLeft = sessionLength * 60;
            updateDisplay();
            statusLed.style.animation = 'blink 2s infinite';
        }

        // FIX: Add function to manually switch between session and break
        function switchMode() {
            if (isRunning) return; // Only allow switching when not running
            
            if (currentMode === 'session') {
                currentMode = 'break';
                timerMode.textContent = 'BREAK';
                screen.classList.add('break-mode');
                timeLeft = breakLength * 60;
            } else {
                currentMode = 'session';
                timerMode.textContent = 'SESSION';
                screen.classList.remove('break-mode');
                timeLeft = sessionLength * 60;
            }
            
            updateDisplay();
        }

        // Event listeners
        focusBtn.addEventListener('click', startTimer);
        pauseBtn.addEventListener('click', pauseTimer);
        resetBtn.addEventListener('click', resetTimer);

        sessionPlus.addEventListener('click', () => updateSessionLength(1));
        sessionMinus.addEventListener('click', () => updateSessionLength(-1));
        breakPlus.addEventListener('click', () => updateBreakLength(1));
        breakMinus.addEventListener('click', () => updateBreakLength(-1));
        
        // FIX: Add double-click on timer mode to switch between session and break
        timerMode.addEventListener('dblclick', switchMode);

        // Initialize
        updateDisplay();
        updateSessionDial();
        updateBreakDial();

        // Add instructions for first-time visitors
        console.log("Pomodoro Timer Instructions:");
        console.log("1. Set session and break lengths using +/- buttons");
        console.log("2. Press FOCUS to start the timer");
        console.log("3. Press PAUSE to pause the timer");
        console.log("4. Press RESET to reset the timer");
        console.log("5. Double-click on 'SESSION' or 'BREAK' text to switch modes");
    </script>
</body>
</html>